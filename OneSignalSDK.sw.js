!function(){"use strict";const t="SafariPush",e="SafariLegacyPush",i="FirefoxPush",n="chrome",a="safari",s="firefox",o=[{t:"Opera",l:/(?:opera|opr|opios)/i,h:/(?:opera|opr|opios)[ /](\d+(?:\.\d+)?)/i},{t:"Facebook",l:/FBAN\//i,h:/FBAV\/(\d+(?:\.\d+)?)/i},{t:"Samsung Browser",l:/samsungbrowser/i,h:/samsungbrowser[ /](\d+(?:\.\d+)?)/i},{t:"Yandex Browser",l:/yabrowser/i,h:/yabrowser[ /](\d+(?:\.\d+)?)/i},{t:"Vivaldi",l:/vivaldi/i,h:/vivaldi[ /](\d+(?:\.\d+)?)/i},{t:"UC Browser",l:/ucbrowser/i,h:/ucbrowser[ /](\d+(?:\.\d+)?)/i},{t:"Microsoft Edge",l:/edg/i,h:/edg[ /](\d+(?:\.\d+)?)/i},{t:"Firefox",l:/firefox|iceweasel|fxios/i,h:/(?:firefox|iceweasel|fxios)[ /](\d+(?:\.\d+)?)/i},{t:"Chromium",l:/chromium/i,h:/chromium[ /](\d+(?:\.\d+)?)/i},{t:"Chrome",l:/chrome|crios|crmo/i,h:/(?:chrome|crios|crmo)[ /](\d+(?:\.\d+)?)/i},{t:"Safari",l:/safari|applewebkit/i,h:/version[ /](\d+(?:\.\d+)?)/i}],r={Chrome:n,Chromium:n,Firefox:s,"Microsoft Edge":"edge",Safari:a};function c(){return r[function(t){for(const e of o)if(e.l.test(t)){const i=t.match(e.h)?.[1]??"";return{name:e.t,version:i}}return{name:"Unknown",version:""}}(navigator.userAgent).name]||"other"}const u="160508",l="undefined"!=typeof window,d=()=>l&&null!=window.safari?.pushNotification,f="undefined"!=typeof PushSubscriptionOptions&&PushSubscriptionOptions.prototype.hasOwnProperty("applicationServerKey"),p=()=>c()===s?i:c()===a&&f&&!d()?t:d()?e:"ChromePush";function w(){switch(p()){case i:return 8;case e:return 7;case t:return 17}return 5}const h=new Error("Missing app ID"),b=new Error("Retry limit reached"),y=new Error("Permission blocked"),m=new Error("AppID doesn't match existing apps");function g(t){return new Promise(e=>setTimeout(e,t))}function v(t,e){return null!=t?t:e}function _(t){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/.test(t)}class S{static m(){return!!self.shouldLog}static v(t){}static _(t){return(...e)=>{(this.m()||"error"===t)&&console[t](...e)}}static S=S._("debug");static k=S._("info");static I=S._("warn");static P=S._("error")}function k(t,e,i){return P("POST",t,e,i)}function I(t,e,i){return P("PUT",t,e,i)}function P(t,e,i,n){if(s=i,!((a=e).startsWith("apps/")||a.startsWith("sync/")?_(a.split("/")[1]):s&&"string"==typeof s.app_id&&_(s.app_id)))return Promise.reject(h);var a,s;const o=new Headers;if(o.append("Origin",self.location.origin),o.append("SDK-Version",`onesignal/web/${u}`),o.append("Content-Type","application/json;charset=UTF-8"),o.append("Accept","application/vnd.onesignal.v1+json"),n)for(const c of Object.keys(n))o.append(c,n[c]);const r={method:t||"NO_METHOD_SPECIFIED",headers:o,cache:"no-cache"};return i&&(r.body=JSON.stringify(i)),O(`${(({action:t,legacy:e=!1}={})=>new URL(e?"https://onesignal.com/api/v1/":"https://api.onesignal.com/"))({action:e}).toString()}${e}`,r)}async function O(t,e,i=5){if(0===i)return Promise.reject(b);try{const i=await fetch(t,e),{status:n,headers:a}=i,s=await i.json(),o=a?.get("Retry-After");return{ok:i.ok,result:s,status:n,retryAfterSeconds:o?parseInt(o):void 0}}catch(n){if(n instanceof Error&&"TypeError"===n.name)return await g(i>3?1e4*(6-i):3e4),S.P(`OneSignal: Network timed out while calling ${t}. Retrying...`),O(t,e,i-1);throw new Error(`Failed to execute HTTP call: ${n}`)}}const D="onesignal_id";function C(t){return encodeURIComponent(t).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`)}async function x(t,e,i){const{appId:n,subscriptionId:a}=t;if(!_(n))throw m;const s=a?{"OneSignal-Subscription-Id":a}:void 0;let o={};return s&&(o={...o,...s}),t.jwtHeader&&(o={...o,...t.jwtHeader}),function(t,e,i){return P("PATCH",t,e,i)}(`apps/${n}/users/by/${C(e.label)}/${C(e.id)}`,i,o)}function T(t){if(!t)throw new Error("App id cannot be empty")}async function N(t){T(t);const e=await(i=`sync/${t}/web`,P("GET",i,null,undefined));var i;return e?.result}const B={scope:"/"},M="push",R="category",A={pageViews:1,timeDelay:0},U="We'd like to show you notifications for the latest news and updates.",W="Allow",$="Cancel",E="Update your push notification subscription preferences.",F="Save Preferences",K="Cancel",L={type:M,text:{actionMessage:U,acceptButton:W,cancelButton:$},autoPrompt:!1,delay:A},V="custom";function H(t){const e=t.config.staticPrompts,i=e.native?{enabled:e.native.enabled,autoPrompt:e.native.enabled&&!1!==e.native.autoPrompt,pageViews:v(e.native.pageViews,A.pageViews),timeDelay:v(e.native.timeDelay,A.timeDelay)}:{enabled:!1,autoPrompt:!1,pageViews:A.pageViews,timeDelay:A.timeDelay},{prompts:n}=e.slidedown;return{autoPrompt:i.autoPrompt||j(n),native:i,slidedown:{prompts:n},fullscreen:{enabled:e.fullscreen.enabled,actionMessage:e.fullscreen.actionMessage,acceptButton:e.fullscreen.acceptButton,cancelButton:e.fullscreen.cancelButton,title:e.fullscreen.title,message:e.fullscreen.message,caption:e.fullscreen.caption,autoAcceptTitle:e.fullscreen.autoAcceptTitle},customlink:z(t)}}function j(t){if(!t)return!1;for(let e=0;e<t.length;e++)if(t[e].autoPrompt)return!0;return!1}function z(t){const e={enabled:!1,style:"button",size:"medium",unsubscribeEnabled:!1,text:{explanation:"",subscribe:"",unsubscribe:""},color:{button:"",text:""}};if(!(t&&t.config&&t.config.staticPrompts&&t.config.staticPrompts.customlink&&t.config.staticPrompts.customlink.enabled))return e;const i=t.config.staticPrompts.customlink;return{enabled:i.enabled,style:i.style,size:i.size,unsubscribeEnabled:i.unsubscribeEnabled,text:i.text?{subscribe:i.text.subscribe,unsubscribe:i.text.unsubscribe,explanation:i.text.explanation}:e.text,color:i.color?{button:i.color.button,text:i.color.text}:e.color}}function q(t){switch(t){case V:case"wordpress":return{configuration:1};default:return{configuration:0}}}function J(t,e,i){let n={enabled:!1};t&&t.customlink&&(n=t.customlink);const a=e.customlink,s={...t,customlink:{enabled:v(n.enabled,a.enabled),style:v(n.style,a.style),size:v(n.size,a.size),unsubscribeEnabled:v(n.unsubscribeEnabled,a.unsubscribeEnabled),text:{subscribe:v(n.text?n.text.subscribe:void 0,a.text.subscribe),unsubscribe:v(n.text?n.text.unsubscribe:void 0,a.text.unsubscribe),explanation:v(n.text?n.text.explanation:void 0,a.text.explanation)},color:{button:v(n.color?n.color.button:void 0,a.color.button),text:v(n.color?n.color.text:void 0,a.color.text)}}};if(s.slidedown?s.slidedown.prompts=s.slidedown?.prompts?.map(t=>{if(t.type=v(t.type,M),t.type===R&&(t.text={...t.text,positiveUpdateButton:v(t.text?.positiveUpdateButton,F),negativeUpdateButton:v(t.text?.negativeUpdateButton,K),updateMessage:v(t.text?.updateMessage,E)}),t.text={...t.text,actionMessage:v(t.text?.actionMessage,U),acceptButton:v(t.text?.acceptButton,W),cancelButton:v(t.text?.cancelButton,$),confirmMessage:v(t.text?.confirmMessage,"Thank You!")},t.autoPrompt=v(t.autoPrompt,!0),t.delay={pageViews:v(t.delay?.pageViews,A.pageViews),timeDelay:v(t.delay?.timeDelay,A.timeDelay)},t.categories){const{categories:e}=t;t.categories=structuredClone(e).slice(0,10)}return t}):(s.slidedown={prompts:[]},s.slidedown.prompts=[L]),s.native){const t=Object.prototype.hasOwnProperty.call(s.native,"autoPrompt");s.native.autoPrompt=t?!!s.native.enabled&&!!s.native.autoPrompt:!!s.native.enabled,s.native.enabled=!!s.native.enabled,s.native.pageViews=v(s.native.pageViews,A.pageViews),s.native.timeDelay=v(s.native.timeDelay,A.timeDelay)}else s.native={enabled:!1,autoPrompt:!1,pageViews:A.pageViews,timeDelay:A.timeDelay};return!0===i.autoRegister&&(s.native.enabled=!0,s.native.autoPrompt=!0),s.autoPrompt=s.native.autoPrompt||j(s.slidedown.prompts),s}async function G(t,e){try{if(!t||!t.appId||!_(t.appId))throw m;const i=await e(t.appId);!function(t){var e;!!(e=t.promptOptions)&&["acceptButtonText","cancelButtonText","actionMessage"].some(t=>Object.prototype.hasOwnProperty.call(e,t))&&(t.promptOptions=function(t){t.slidedown||(t.slidedown={});const{slidedown:e}=t;return e.acceptButtonText=e.acceptButtonText??t.acceptButtonText??t.acceptButton,e.cancelButtonText=e.cancelButtonText??t.cancelButtonText??t.cancelButton,e.actionMessage=e.actionMessage??t.actionMessage,t}(t.promptOptions)),function(t){return!!t&&["enabled","autoPrompt","pageViews","timeDelay","acceptButton","acceptButtonText","cancelButton","cancelButtonText","actionMessage","customizeTextEnabled","categories"].some(e=>Object.prototype.hasOwnProperty.call(t,e))}(t.promptOptions?.slidedown)&&t.promptOptions?.slidedown&&(t.promptOptions.slidedown=function(t){const e=(s=t,(s?.categories?.tags?.length||0)>0),i=e?R:M,{categories:n,prompts:a=[]}=t;var s;return{prompts:[...a,{type:i,autoPrompt:t.autoPrompt,text:{actionMessage:t.actionMessage,acceptButton:t.acceptButton??t.acceptButtonText,cancelButton:t.cancelButton??t.cancelButtonText,...e&&{positiveUpdateButton:n?.positiveUpdateButton,negativeUpdateButton:n?.negativeUpdateButton,updateMessage:n?.updateMessage}},delay:{pageViews:t.pageViews,timeDelay:t.timeDelay},categories:n?.tags}]}}(t.promptOptions?.slidedown))}(t);const n=function(t,e){const i=function(t){return t.config.integration?.kind??V}(e),n=function(t,e,i){switch(q(t).configuration){case 0:return i.config.siteInfo.proxyOriginEnabled;case 1:return!!e.subdomainName}}(i,t,e),a=function(t,e,i){switch(q(t).configuration){case 0:{const{path:t,serviceWorkerPath:n,serviceWorkerParam:a}=function(t,e){const{serviceWorker:i}=e.config,n=t.serviceWorkerOverrideForTypical;return{path:n?v(t.path,i.path):i.path,serviceWorkerParam:n?v(t.serviceWorkerParam,{scope:i.registrationScope}):{scope:i.registrationScope},serviceWorkerPath:n?v(t.serviceWorkerPath,i.workerName):i.workerName}}(e,i);return{appId:i.app_id,autoRegister:!1,autoResubscribe:i.config.autoResubscribe,path:t,serviceWorkerPath:n,serviceWorkerParam:a,subdomainName:i.config.siteInfo.proxyOrigin,promptOptions:H(i),welcomeNotification:{disable:!i.config.welcomeNotification.enable,title:i.config.welcomeNotification.title,message:i.config.welcomeNotification.message,url:i.config.welcomeNotification.url},notifyButton:{enable:i.config.staticPrompts.bell.enabled,displayPredicate:null,size:i.config.staticPrompts.bell.size,position:i.config.staticPrompts.bell.location,showCredit:!1,offset:{bottom:`${i.config.staticPrompts.bell.offset.bottom}px`,left:`${i.config.staticPrompts.bell.offset.left}px`,right:`${i.config.staticPrompts.bell.offset.right}px`},colors:{"circle.background":i.config.staticPrompts.bell.color.main,"circle.foreground":i.config.staticPrompts.bell.color.accent,"badge.background":"black","badge.foreground":"white","badge.bordercolor":"black","pulse.color":i.config.staticPrompts.bell.color.accent,"dialog.button.background.hovering":i.config.staticPrompts.bell.color.main,"dialog.button.background.active":i.config.staticPrompts.bell.color.main,"dialog.button.background":i.config.staticPrompts.bell.color.main,"dialog.button.foreground":"white"},text:{"tip.state.unsubscribed":i.config.staticPrompts.bell.tooltip.unsubscribed,"tip.state.subscribed":i.config.staticPrompts.bell.tooltip.subscribed,"tip.state.blocked":i.config.staticPrompts.bell.tooltip.blocked,"message.prenotify":i.config.staticPrompts.bell.tooltip.unsubscribed,"message.action.subscribing":i.config.staticPrompts.bell.message.subscribing,"message.action.subscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.resubscribed":i.config.staticPrompts.bell.message.subscribing,"message.action.unsubscribed":i.config.staticPrompts.bell.message.unsubscribing,"dialog.main.title":i.config.staticPrompts.bell.dialog.main.title,"dialog.main.button.subscribe":i.config.staticPrompts.bell.dialog.main.subscribeButton,"dialog.main.button.unsubscribe":i.config.staticPrompts.bell.dialog.main.unsubscribeButton,"dialog.blocked.title":i.config.staticPrompts.bell.dialog.blocked.title,"dialog.blocked.message":i.config.staticPrompts.bell.dialog.blocked.message}},persistNotification:i.config.notificationBehavior?i.config.notificationBehavior.display.persist:void 0,webhooks:{cors:i.config.webhooks.corsEnable,"notification.willDisplay":i.config.webhooks.notificationDisplayedHook,"notification.clicked":i.config.webhooks.notificationClickedHook,"notification.dismissed":i.config.webhooks.notificationDismissedHook},notificationClickHandlerMatch:i.config.notificationBehavior?i.config.notificationBehavior.click.match:void 0,notificationClickHandlerAction:i.config.notificationBehavior?i.config.notificationBehavior.click.action:void 0,outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}}}case 1:{const t={...e,promptOptions:J(e.promptOptions,i.config.staticPrompts,e),serviceWorkerParam:e.serviceWorkerParam?e.serviceWorkerParam:B,serviceWorkerPath:e.serviceWorkerPath?e.serviceWorkerPath:"OneSignalSDKWorker.js",path:e.path?e.path:"/",outcomes:{direct:i.config.outcomes.direct,indirect:{enabled:i.config.outcomes.indirect.enabled,influencedTimePeriodMin:i.config.outcomes.indirect.notification_attribution.minutes_since_displayed,influencedNotificationsLimit:i.config.outcomes.indirect.notification_attribution.limit},unattributed:i.config.outcomes.unattributed}};return Object.prototype.hasOwnProperty.call(e,"autoResubscribe")?t.autoResubscribe=!!e.autoResubscribe:Object.prototype.hasOwnProperty.call(e,"autoRegister")?t.autoResubscribe=!!e.autoRegister:t.autoResubscribe=!!i.config.autoResubscribe,t}}}(i,t,e);return{appId:e.app_id,hasUnsupportedSubdomain:n,siteName:e.config.siteInfo.name,origin:e.config.origin,restrictedOriginEnabled:e.features.restrict_origin&&e.features.restrict_origin.enable,safariWebId:e.config.safari_web_id,vapidPublicKey:e.config.vapid_public_key,onesignalVapidPublicKey:e.config.onesignal_vapid_public_key,userConfig:a,enableOnSession:v(e.features.enable_on_session,false),sessionThreshold:v(e.features.session_threshold,30),enableSessionDuration:v(e.features.web_on_focus_enabled,true)}}(t,i);return function(t){const e=!self.isSecureContext;if(t.hasUnsupportedSubdomain||e)throw e?new Error("OneSignalSDK: HTTP sites are no longer supported starting with version 16 (User Model), your public site must start with https://."):new Error('OneSignalSDK: The "My site is not fully HTTPS" option is no longer supported starting with version 16 (User Model) of the OneSignal SDK.')}(n),n}catch(i){if(i instanceof Object&&"code"in i){if(1===i.code)throw m;if(2===i.code)throw new Error("App not configured for web push")}throw i}}const Y=(t,e)=>e.some(e=>t instanceof e);let X,Q;const Z=new WeakMap,tt=new WeakMap,et=new WeakMap;let it={get(t,e,i){if(t instanceof IDBTransaction){if("done"===e)return Z.get(t);if("store"===e)return i.objectStoreNames[1]?void 0:i.objectStore(i.objectStoreNames[0])}return st(t[e])},set:(t,e,i)=>(t[e]=i,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function nt(t){it=t(it)}function at(t){return"function"==typeof t?(e=t,(Q||(Q=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(ot(this),t),st(this.request)}:function(...t){return st(e.apply(ot(this),t))}):(t instanceof IDBTransaction&&function(t){if(Z.has(t))return;const e=new Promise((e,i)=>{const n=()=>{t.removeEventListener("complete",a),t.removeEventListener("error",s),t.removeEventListener("abort",s)},a=()=>{e(),n()},s=()=>{i(t.error||new DOMException("AbortError","AbortError")),n()};t.addEventListener("complete",a),t.addEventListener("error",s),t.addEventListener("abort",s)});Z.set(t,e)}(t),Y(t,X||(X=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,it):t);var e}function st(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,i)=>{const n=()=>{t.removeEventListener("success",a),t.removeEventListener("error",s)},a=()=>{e(st(t.result)),n()},s=()=>{i(t.error),n()};t.addEventListener("success",a),t.addEventListener("error",s)});return et.set(e,t),e}(t);if(tt.has(t))return tt.get(t);const e=at(t);return e!==t&&(tt.set(t,e),et.set(e,t)),e}const ot=t=>et.get(t),rt=["get","getKey","getAll","getAllKeys","count"],ct=["put","add","delete","clear"],ut=new Map;function lt(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(ut.get(e))return ut.get(e);const i=e.replace(/FromIndex$/,""),n=e!==i,a=ct.includes(i);if(!(i in(n?IDBIndex:IDBObjectStore).prototype)||!a&&!rt.includes(i))return;const s=async function(t,...e){const s=this.transaction(t,a?"readwrite":"readonly");let o=s.store;return n&&(o=o.index(e.shift())),(await Promise.all([o[i](...e),a&&s.done]))[0]};return ut.set(e,s),s}nt(t=>({...t,get:(e,i,n)=>lt(e,i)||t.get(e,i,n),has:(e,i)=>!!lt(e,i)||t.has(e,i)}));const dt=["continue","continuePrimaryKey","advance"],ft={},pt=new WeakMap,wt=new WeakMap,ht={get(t,e){if(!dt.includes(e))return t[e];let i=ft[e];return i||(i=ft[e]=function(...t){pt.set(this,wt.get(this)[e](...t))}),i}};async function*bt(...t){let e=this;if(e instanceof IDBCursor||(e=await e.openCursor(...t)),!e)return;const i=new Proxy(e,ht);for(wt.set(i,e),et.set(i,ot(e));e;)yield i,e=await(pt.get(i)||e.continue()),pt.delete(i)}function yt(t,e){return e===Symbol.asyncIterator&&Y(t,[IDBIndex,IDBObjectStore,IDBCursor])||"iterate"===e&&Y(t,[IDBIndex,IDBObjectStore])}nt(t=>({...t,get:(e,i,n)=>yt(e,i)?bt:t.get(e,i,n),has:(e,i)=>yt(e,i)||t.has(e,i)}));const mt="oneSignalSession",gt="active",vt="inactive";let _t=!1;const St=async(t=7)=>function(t,e,{blocked:i,upgrade:n,blocking:a,terminated:s}={}){const o=indexedDB.open(t,e),r=st(o);return n&&o.addEventListener("upgradeneeded",t=>{n(st(o.result),t.oldVersion,t.newVersion,st(o.transaction),t)}),i&&o.addEventListener("blocked",t=>i(t.oldVersion,t.newVersion,t)),r.then(t=>{s&&t.addEventListener("close",()=>s()),a&&t.addEventListener("versionchange",t=>a(t.oldVersion,t.newVersion,t))}).catch(()=>{}),r}("ONE_SIGNAL_SDK_DB",t,{upgrade(e,i,n,a){const s=n||t;s>=1&&i<1&&(e.createObjectStore("Ids",{keyPath:"type"}),e.createObjectStore("NotificationOpened",{keyPath:"url"}),e.createObjectStore("Options",{keyPath:"key"})),s>=2&&i<2&&(e.createObjectStore("Sessions",{keyPath:"sessionKey"}),e.createObjectStore("NotificationReceived",{keyPath:"notificationId"}),e.createObjectStore("NotificationClicked",{keyPath:"notificationId"})),s>=3&&i<3&&e.createObjectStore("SentUniqueOutcome",{keyPath:"outcomeName"}),s>=4&&i<4&&(e.createObjectStore("identity",{keyPath:"modelId"}),e.createObjectStore("properties",{keyPath:"modelId"}),e.createObjectStore("pushSubscriptions",{keyPath:"modelId"}),e.createObjectStore("smsSubscriptions",{keyPath:"modelId"}),e.createObjectStore("emailSubscriptions",{keyPath:"modelId"})),s>=5&&i<5&&(async function(t,e){const i="NotificationClicked",n="Outcomes.NotificationClicked";t.createObjectStore(n,{keyPath:"notificationId"});let a=await e.objectStore(i).openCursor();for(;a;){const t=a.value;await e.objectStore(n).put({notificationId:t.notificationId||t.notification.id,appId:t.appId,timestamp:t.timestamp}),a=await a.continue()}t.deleteObjectStore(i)}(e,a),async function(t,e){const i="NotificationReceived",n="Outcomes.NotificationReceived";t.createObjectStore(n,{keyPath:"notificationId"});let a=await e.objectStore(i).openCursor();for(;a;)await e.objectStore(n).put(a.value),a=await a.continue();t.deleteObjectStore(i)}(e,a)),s>=6&&i<6&&async function(t,e){const i="subscriptions";let n;t.createObjectStore(i,{keyPath:"modelId"});const a=await e.objectStore("identity").getAll();a.length>0&&(n=a[0].externalId);for(const s of["emailSubscriptions","pushSubscriptions","smsSubscriptions"]){let a=await e.objectStore(s).openCursor();for(;a;)await e.objectStore(i).put({...a.value,modelName:"subscriptions",externalId:n}),a=await a.continue();t.deleteObjectStore(s)}}(e,a),s>=7&&i<7&&e.createObjectStore("operations",{keyPath:"modelId"}),_t=!1},blocked(){S.S("IndexedDB: Blocked event")},terminated(){_t||(_t=!0,It())}});let kt=St();const It=(t=7)=>(kt=St(t),kt),Pt=async(t,e)=>(await kt).get(t,e),Ot=async t=>(await kt).getAll(t),Dt=async(t,e)=>(await kt).put(t,e),Ct=async(t,e)=>(await kt).delete(t,e),xt=async t=>(await kt).clear(t),Tt=async t=>{const e=await Pt("Options",t);return e&&"value"in e?e.value:null},Nt=async()=>await Pt("Sessions",mt)??null,Bt=async()=>{await Ct("Sessions",mt)},Mt=async(t,e)=>{await Dt("Outcomes.NotificationReceived",function(t,e,i){return{appId:t,notificationId:e.notificationId,timestamp:i}}(t,e,Date.now()))},Rt=async()=>(await Ot("Outcomes.NotificationClicked")).map(t=>{return{appId:(e=t).appId,notificationId:e.notificationId,timestamp:e.timestamp};var e});class At{deviceId;subscriptionToken;optedOut;createdAt;expirationTime;O(){return{deviceId:this.deviceId,subscriptionToken:this.subscriptionToken,optedOut:this.optedOut,createdAt:this.createdAt,expirationTime:this.expirationTime}}static D(t){const e=new At;return e.deviceId=t.deviceId,e.subscriptionToken=t.subscriptionToken,e.optedOut=t.optedOut,e.createdAt=t.createdAt,e.expirationTime=t.expirationTime,e}}const Ut=async()=>{const t=new At;t.deviceId=(await Pt("Ids","userId"))?.id,t.subscriptionToken=(await Pt("Ids","registrationId"))?.id;const e=await Tt("optedOut"),i=await Tt("subscription"),n=await Tt("subscriptionCreatedAt"),a=await Tt("subscriptionExpirationTime");return t.optedOut=null!=e?e:null!=i&&!i,t.createdAt=n??null,t.expirationTime=a??null,t},Wt=async t=>{t.deviceId&&await Dt("Ids",{type:"userId",id:t.deviceId}),void 0!==t.subscriptionToken&&await Dt("Ids",{type:"registrationId",id:t.subscriptionToken}),null!=t.optedOut&&await Dt("Options",{key:"optedOut",value:t.optedOut}),null!=t.createdAt&&await Dt("Options",{key:"subscriptionCreatedAt",value:t.createdAt}),null!=t.expirationTime?await Dt("Options",{key:"subscriptionExpirationTime",value:t.expirationTime}):await Ct("Options","subscriptionExpirationTime")};function $t(t,e){const i=1e3*e;let n,a=()=>{};return{promise:new Promise((e,s)=>{let o=!1;n=self.setTimeout(async()=>{o=!0;try{await t(),e()}catch(i){S.P("Failed to execute callback",i),s()}},i),a=()=>{S.S("Cancel called"),self.clearTimeout(n),o||e()}}),cancel:a}}function Et(t){const e=(new Date).getTime(),i=t&&t.notificationId||null;return{accumulatedDuration:0,appId:t.appId,lastActivatedTimestamp:e,lastDeactivatedTimestamp:null,notificationId:i,sessionKey:mt,startTimestamp:e,status:gt}}async function Ft(t,e,i,n,a){1!==n&&(Dt("Sessions",a),Lt(),await async function(t,e,i){const n={label:D,id:e},a={refresh_device_metadata:!0,deltas:{session_count:1}};T(t),function(t){if(!t.id)throw new Error("Alias id cannot be empty")}(n);try{await x({appId:t,subscriptionId:i},n,a)}catch(s){S.S("Error updating user session:",s)}}(t,e,i))}async function Kt(t,e,i,n,a,s){if(S.S("Finalize session",`started: ${new Date(n.startTimestamp)}`,`duration: ${n.accumulatedDuration}s`),a){S.S(`send on_focus reporting session duration -> ${n.accumulatedDuration}s`);const a=await async function(t){if(t.direct&&t.direct.enabled){const t=await Rt();if(t.length>0)return{type:1,notificationIds:[t[0].notificationId]}}if(t.indirect&&t.indirect.enabled){const e=60*t.indirect.influencedTimePeriodMin*1e3,i=new Date((new Date).getTime()-e).getTime(),n=await(async()=>(await Ot("Outcomes.NotificationReceived")).map(t=>{return{appId:(e=t).appId,notificationId:e.notificationId,timestamp:e.timestamp};var e}))();if(S.S(`\tFound total of ${n.length} received notifications`),n.length>0){const e=t.indirect.influencedNotificationsLimit,a=function(t,e,i=!1,n=!0){const a=n?t:t.slice();return a.sort((t,n)=>{const a=e(t),s=e(n);return a>s?i?-1:1:a<s?i?1:-1:0}),a}(n,t=>t.timestamp,!0,!1),s=a.filter(t=>t.timestamp>=i).slice(0,e).map(t=>t.notificationId);S.S(`\tTotal of ${s.length} received notifications are within reporting window.`);const o=a.filter(t=>-1===s.indexOf(t.notificationId)).map(t=>t.notificationId);if(o.forEach(t=>Ct("Outcomes.NotificationReceived",t)),S.S(`\t${o.length} received notifications will be deleted.`),s.length>0)return{type:2,notificationIds:s}}}return t.unattributed&&t.unattributed.enabled?{type:3,notificationIds:[]}:{type:4,notificationIds:[]}}(s);S.S("send on_focus with attribution",a),await async function(t,e,i,n,a){const s={refresh_device_metadata:!0,deltas:{session_time:n}},o={label:D,id:e},r={id:"os__session_duration",app_id:t,session_time:n,notification_ids:a.notificationIds,subscription:{id:i,type:p()},onesignal_id:e};r.direct=1===a.type;try{await x({appId:t,subscriptionId:i},o,s),r.notification_ids&&r.notification_ids.length>0&&await async function(t){S.k("Outcome payload:",t);try{await k("outcomes/measure",t)}catch(e){S.P("sendOutcome",e)}}(r)}catch(c){S.S("Error sending session duration:",c)}}(t,e,i,n.accumulatedDuration,a)}await Promise.all([Bt(),xt("Outcomes.NotificationClicked")]),S.S("Finalize session finished",`started: ${new Date(n.startTimestamp)}`)}const Lt=async()=>{const t=(await Ot("SentUniqueOutcome")).map(t=>(t.sentDuringSession=null,Dt("SentUniqueOutcome",t)));await Promise.all(t)};function Vt(t,e){return t<=e?0:Math.floor((t-e)/1e3)}const Ht="GetWorkerVersion",jt="Subscribe",zt="SubscribeNew";class qt{C;constructor(){this.C={}}T(t,e,i){const n={callback:e,onceListenerOnly:i},a=this.C[t.toString()];a?a.push(n):this.C[t.toString()]=[n]}N(t){return this.C[t.toString()]||[]}B(t){this.C[t.toString()]=null}M(){this.C={}}R(t,e){const i=this.C[t.toString()];if(null!=i)for(let n=i.length-1;n>=0;n--)i[n]===e&&i.splice(n,1)}}class Jt{A;C;constructor(t,e=new qt){this.A=t,this.C=e}U(t,e){this.C.T(t,e,!1)}W(t,e){this.C.T(t,e,!0)}$(t){t?this.C.B(t):this.C.M()}}class Gt extends Jt{async F(){self.addEventListener("message",this.K.bind(this)),S.S("[Worker Messenger] Service worker is now listening for messages.")}K(t){const e=t.data;if(!e||!e.command)return;const i=this.C.N(e.command),n=[],a=[];S.S("[Worker Messenger] Service worker received message:",t.data);for(const s of i)s.onceListenerOnly&&n.push(s),a.push(s);for(let s=n.length-1;s>=0;s--){const t=n[s];this.C.R(e.command,t)}for(const s of a)s.callback.apply(null,[e.payload])}async L(t,e){const i=await self.clients.matchAll({type:"window",includeUncontrolled:!0});for(const n of i)S.S(`[Worker Messenger] [SW -> Page] Broadcasting '${t.toString()}' to window client ${n.url}.`),n.postMessage({command:t,payload:e})}async V(t,e,i){if(!i)throw new Error('"windowClient" is empty');S.S(`[Worker Messenger] [SW -> Page] Unicasting '${t.toString()}' to window client ${i.url}.`),i.postMessage({command:t,payload:e})}}class Yt{w3cEndpoint;w3cP256dh;w3cAuth;safariDeviceToken;static H(t){const e=new Yt;if(t&&(e.w3cEndpoint=new URL(t.endpoint),t.getKey)){let n=null;try{n=t.getKey("p256dh")}catch(i){}let a=null;try{a=t.getKey("auth")}catch(i){}if(n){const t=btoa(String.fromCharCode(...new Uint8Array(n)));e.w3cP256dh=t}if(a){const t=btoa(String.fromCharCode(...new Uint8Array(a)));e.w3cAuth=t}}return e}j(t){t&&(this.safariDeviceToken=t)}O(){return{w3cEndpoint:this.w3cEndpoint?this.w3cEndpoint.toString():null,w3cP256dh:this.w3cP256dh,w3cAuth:this.w3cAuth,safariDeviceToken:this.safariDeviceToken}}static D(t){const e=new Yt;if(!t)return e;try{e.w3cEndpoint=new URL(t.w3cEndpoint)}catch(i){}return e.w3cP256dh=t.w3cP256dh,e.w3cAuth=t.w3cAuth,e.safariDeviceToken=t.safariDeviceToken,e}}class Xt{A;q;constructor(t,e){this.A=t,this.q=e}async J(t,e){t&&(t=Yt.D(t)),await this.G();const i=await Ut();return i.deviceId="99999999-9999-9999-9999-999999999999",i.optedOut=!1,t?d()?i.subscriptionToken=t.safariDeviceToken:i.subscriptionToken=t.w3cEndpoint?t.w3cEndpoint.toString():null:i.subscriptionToken=null,await Wt(i),"undefined"!=typeof OneSignal&&(OneSignal._sessionInitAlreadyRunning=!1),i}async G(){const{deviceId:t}=await Ut();return!!t}async Y(t,e){const i=await t.getSubscription();switch(e){case 0:if(!i)break;i.options?S.S("[Subscription Manager] An existing push subscription exists and it's options is not null."):(S.S("[Subscription Manager] An existing push subscription exists and options is null. Unsubscribing from push first now."),await Xt.X(i));break;case 1:i&&await Xt.X(i)}const[n,a]=await Xt.Z(t,this.tt());return await Xt.et(a,n.expirationTime),Yt.H(n)}tt(){let t;return t=c()===s?this.q.onesignalVapidPublicKey:this.q.vapidPublicKey,t?function(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),i=atob(e),n=new Uint8Array(i.length);for(let a=0;a<i.length;++a)n[a]=i.charCodeAt(a);return n}(t).buffer:void 0}static async et(t,e){const i=await Ut();t&&(i.createdAt=(new Date).getTime()),i.expirationTime=e,await Wt(i)}static async Z(t,e){if(!e)throw new Error("Missing required 'applicationServerKey' to subscribe for push notifications!");const i={userVisibleOnly:!0,applicationServerKey:e};S.S("[Subscription Manager] Subscribing to web push with these options:",i);try{const e=await t.getSubscription();return[await t.subscribe(i),!e]}catch(n){if(n instanceof Error){S.I("[Subscription Manager] Couldn't re-subscribe due to applicationServerKey changing, unsubscribe and attempting to subscribe with new key.",n);const e=await t.getSubscription();return e&&await Xt.X(e),[await t.subscribe(i),!0]}throw n}}static async X(t){S.S("[Subscription Manager] Unsubscribing existing push subscription.");const e=await t.unsubscribe();return S.S(`[Subscription Manager] Unsubscribing existing push subscription result: ${e}`),e}}class Qt extends Xt{async it(t){return await this.nt(t)}async nt(t){const e=self.registration;if(!e.active&&c()!==s)throw new Error("SW not activated");const i=await e.pushManager.permissionState({userVisibleOnly:!0});if("denied"===i)throw y;if("prompt"===i)throw new Error("Permission not granted");return await this.Y(e.pushManager,t)}}class Zt{st;ot;rt;constructor(t){var e;this.st=t,this.ot=new Qt(this,{safariWebId:(e=this.st).safariWebId,appId:e.appId,vapidPublicKey:e.vapidPublicKey,onesignalVapidPublicKey:e.onesignalVapidPublicKey}),this.rt=new Gt(this)}}function te(t){return{notificationId:t.custom.i,title:t.title,body:t.alert,additionalData:t.custom.a,launchURL:t.custom.u,confirmDelivery:"y"===t.custom.rr,icon:t.icon,image:t.image,actionButtons:(e=t.o,e?.map(t=>({actionId:t.i,text:t.n,icon:t.p,launchURL:t.u}))),topic:t.tag,badgeIcon:t.badge};var e}class ee{async send(t){const e=await Tt(`webhooks.${t.event}`);if(!e)return;const i=await Tt("webhooks.cors"),n={method:"post",mode:"no-cors",body:JSON.stringify(t)};i&&(n.mode="cors",n.headers={"X-OneSignal-Event":t.event,"Content-Type":"application/json"}),S.S(`Executing ${t.event} webhook ${i?"with":"without"} CORS POST ${e}`,t),await fetch(e,n)}}class ie{sender;constructor(t=new ee){this.sender=t}async click(t,e){const i=t.notification;return await this.sender.send({event:"notification.clicked",notificationId:i.notificationId,heading:i.title,content:i.body,additionalData:i.additionalData,actionId:t.result.actionId,url:t.result.url,subscriptionId:e})}async willDisplay(t,e){return await this.sender.send({event:"notification.willDisplay",notificationId:t.notificationId,heading:t.title,content:t.body,additionalData:t.additionalData,url:t.launchURL,subscriptionId:e})}async dismiss(t,e){return await this.sender.send({event:"notification.dismissed",notificationId:t.notificationId,heading:t.title,content:t.body,additionalData:t.additionalData,url:t.launchURL,subscriptionId:e})}}class ne{static get ct(){return new ie}static async ut(){const t=await self.registration.pushManager.getSubscription(),e=t?.endpoint;if(e)return async function(t){const e=await Ot("subscriptions");for(const i of e)if(i.token===t)return i.id}(e)}static get rt(){return self.rt||(self.rt=new Gt(void 0)),self.rt}static lt(){self.addEventListener("activate",ne.dt),self.addEventListener("push",ne.ft),self.addEventListener("notificationclose",t=>t.waitUntil(ne.wt(t))),self.addEventListener("notificationclick",t=>t.waitUntil(ne.ht(t))),self.addEventListener("pushsubscriptionchange",t=>{t.waitUntil(ne.bt(t))}),self.addEventListener("message",t=>{const e=t.data,i=e?.payload;switch(e?.command){case"os.session.upsert":S.S("[Service Worker] Received SessionUpsert",i),ne.yt(t,i);break;case"os.session.deactivate":S.S("[Service Worker] Received SessionDeactivate",i),ne.yt(t,i);break;default:return}}),S.S("Setting up message listeners."),setTimeout(()=>{ne.rt.F(),ne.gt()},0)}static async vt(){if(self.location.search){const t=self.location.search.match(/appId=([0-9a-z-]+)&?/i);if(t&&t.length>1)return t[1]}const{appId:t}=await(async()=>{const t={},e=await(async()=>{const t=await Pt("Ids","appId");return t&&"id"in t?t.id:null})();return t.appId=e,t.vapidPublicKey=await Tt("vapidPublicKey"),t})();return t}static gt(){ne.rt.U(Ht,()=>{S.S("[Service Worker] Received worker version message."),ne.rt.L(Ht,u)}),ne.rt.U(jt,async t=>{const e=t;S.S("[Service Worker] Received subscribe message.");const i=new Zt(e),n=await i.ot.it(0),a=await i.ot.J(n);ne.rt.L(jt,a.O())}),ne.rt.U(zt,async t=>{const e=t;S.S("[Service Worker] Received subscribe new message.");const i=new Zt(e),n=await i.ot.it(1),a=await i.ot.J(n);ne.rt.L(zt,a.O())}),ne.rt.U("os.page_focused_response",async t=>{S.S("[Service Worker] Received response for AreYouVisible",t);const e=t.timestamp;self.clientsStatus?.timestamp===e&&(self.clientsStatus.receivedResponsesCount++,t.focused&&(self.clientsStatus.hasAnyActiveSessions=!0))}),ne.rt.U("os.set_sw_logging",async t=>{t.shouldLog?self.shouldLog=!0:self.shouldLog=void 0})}static ft(t){S.S(`Called onPushReceived(${JSON.stringify(t,null,4)}):`,t),t.waitUntil(ne._t(t).then(async t=>{const e=[],i=[],n=await ne.vt();for(const a of t){S.S("Raw Notification from OneSignal:",a);const t=te(a);i.push(Mt(n,t)),e.push((async t=>{const e={notification:t};await ne.rt.L("notification.willDisplay",e).catch(t=>S.P(t));const i=await ne.ut();return ne.ct.willDisplay(t,i),ne.St(t).then(()=>ne.kt(t)).catch(t=>S.P(t))}).bind(null,t))}return e.reduce((t,e)=>t.then(e),Promise.resolve())}).catch(t=>{S.S("Failed to display a notification:",t)}))}static async kt(t){if(!t)return;if(!ne.It())return null;if(!t.confirmDelivery)return;const e=await ne.vt(),i=await this.ut();if(!e||!t.notificationId)return;const n={player_id:i,app_id:e,device_type:w()};S.S(`Called sendConfirmedDelivery(${JSON.stringify(t,null,4)})`),await g(Math.floor(25*Math.random()*1e3)),await I(`notifications/${t.notificationId}/report_received`,n)}static It(){return c()!==a}static async Pt(){return await self.clients.matchAll({type:"window",includeUncontrolled:!0})}static async Ot(t,e,i){if(e)await async function(t,e,i,n,a,s,o){const r=await Nt();if(!r){const n=Et({appId:t}),a=await(async t=>{let e=[];try{e=await Rt()}catch(i){S.P("Database.getLastNotificationClickedForOutcomes",i)}return e.find(e=>e.appId===t)||null})(t);return a&&(n.notificationId=a.notificationId),await Dt("Sessions",n),void(await Ft(t,e,i,s,n))}if(r.status===gt)return void S.S("Session already active",r);if(!r.lastDeactivatedTimestamp)return void S.S("Session is in invalid state",r);const c=(new Date).getTime();if(Vt(c,r.lastDeactivatedTimestamp)<=n)return r.status=gt,r.lastActivatedTimestamp=c,r.lastDeactivatedTimestamp=null,void(await Dt("Sessions",r));await Kt(t,e,i,r,a,o);const u=Et({appId:t});await Dt("Sessions",u),await Ft(t,e,i,s,u)}(i.appId,i.onesignalId,i.subscriptionId,i.sessionThreshold,i.enableSessionDuration,i.sessionOrigin,i.outcomesConfig);else{const e=await async function(t,e,i,n,a,s){const o=await Nt();if(!o)return void S.S("No active session found. Cannot deactivate.");const r=()=>Kt(t,e,i,o,a,s);if(o.status===vt)return $t(r,n);if(o.status!==gt)return void S.I(`Session in invalid state ${o.status}. Cannot deactivate.`);const c=(new Date).getTime(),u=Vt(c,o.lastActivatedTimestamp);o.lastDeactivatedTimestamp=c,o.accumulatedDuration+=u,o.status=vt;const l=$t(r,n);return await Dt("Sessions",o),l}(i.appId,i.onesignalId,i.subscriptionId,i.sessionThreshold,i.enableSessionDuration,i.outcomesConfig);e&&(self.cancel=e.cancel,t.waitUntil(e.promise))}}static async Dt(t,e){S.S("[Service Worker] refreshSession");const i=await this.Pt();if(e.isSafari)await ne.Ct(t,i,e);else{const n=i.some(t=>t.focused);S.S("[Service Worker] hasAnyActiveSessions",n),await ne.Ot(t,n,e)}}static async Ct(t,e,i){const n=(new Date).getTime();self.clientsStatus={timestamp:n,sentRequestsCount:0,receivedResponsesCount:0,hasAnyActiveSessions:!1};const a={timestamp:n};e.forEach(t=>{self.clientsStatus.sentRequestsCount++,t.postMessage({command:"os.page_focused_request",payload:a})});const s=$t(async()=>{S.S("updateSessionBasedOnHasActive",self.clientsStatus),await ne.Ot(t,self.clientsStatus.hasAnyActiveSessions,i),self.clientsStatus=void 0},.5);self.cancel=s.cancel,t.waitUntil(s.promise)}static yt(t,e){S.S("[Service Worker] debounceRefreshSession",e),self.cancel&&(self.cancel(),self.cancel=void 0);const i=$t(async()=>{await ne.Dt(t,e)},1);self.cancel=i.cancel,t.waitUntil(i.promise)}static xt(t){if(t)try{const e=new URL(t);return"localhost"===e.hostname||-1!==e.hostname.indexOf("192.168")||"127.0.0.1"===e.hostname||"https:"===e.protocol?t:"i0.wp.com"===e.hostname||"i1.wp.com"===e.hostname||"i2.wp.com"===e.hostname||"i3.wp.com"===e.hostname?`https://${e.hostname}${e.pathname}`:`https://i0.wp.com/${e.host+e.pathname}`}catch(e){S.P("ensureImageResourceHttps: ",e)}}static Tt(t){if(t&&(t.icon&&(t.icon=ne.xt(t.icon)),t.image&&(t.image=ne.xt(t.image)),t.actionButtons&&t.actionButtons.length>0))for(const e of t.actionButtons)e.icon&&(e.icon=ne.xt(e.icon))}static async St(t){S.S(`Called displayNotification(${JSON.stringify(t,null,4)}):`,t);const e=await ne.Nt(),i=await Tt("defaultIcon"),n=await Tt("persistNotification"),a=await ne.vt();t.title=t.title?t.title:e,t.icon=t.icon?t.icon:i||void 0,ne.Tt(t);const s={body:t.body,icon:t.icon,image:t.image,data:t,actions:(o=t.actionButtons,o?.map(t=>({action:t.actionId,title:t.text,icon:t.icon}))),tag:t.topic||a,requireInteraction:!1!==n,renotify:!0,badge:t.badgeIcon};var o;await self.registration.showNotification(t.title,s),this.Bt()&&await g(1e3)}static Bt(){const t=navigator.userAgentData,e="macOS"===t?.platform,i=!!t?.brands?.some(t=>"Chromium"===t.brand);return e&&i}static Mt(t){return"javascript:void(0);"!==t&&"do_not_open"!==t&&!((e=t)&&-1!==e.indexOf("_osp=do_not_open"));var e}static async wt(t){S.S(`Called onNotificationClosed(${JSON.stringify(t,null,4)}):`,t);const e=t.notification.data;ne.rt.L("notification.dismissed",e).catch(t=>S.P(t));const i=await ne.ut();ne.ct.dismiss(e,i)}static async Rt(t,e){if(e){const i=t?.actionButtons?.find(t=>t.actionId===e);if(i?.launchURL&&""!==i.launchURL)return i.launchURL}if(t.launchURL&&""!==t.launchURL)return t.launchURL;const{defaultNotificationUrl:i}=await(async()=>{const t=await Tt("defaultUrl"),e=await Tt("defaultTitle"),i=await Tt("isPushEnabled"),n=await Tt("lastOptedIn");return{defaultNotificationUrl:t,defaultNotificationTitle:e,lastKnownPushEnabled:i,lastKnownPushId:await Tt("lastPushId")??void 0,lastKnownPushToken:await Tt("lastPushToken")??void 0,lastKnownOptedIn:n}})();return i||location.origin}static async ht(t){S.S(`Called onNotificationClicked(${JSON.stringify(t,null,4)}):`,t),t.notification.close();const e=t.notification.data;let i="exact",n="navigate";const a=await Tt("notificationClickHandlerMatch");a&&(i=a);const s=await Tt("notificationClickHandlerAction");s&&(n=s);const o=await ne.Rt(e,t.action),r=ne.Mt(o),c=await ne.vt(),u=w(),l={notification:e,result:{actionId:t.action,url:o},timestamp:(new Date).getTime()};S.k("NotificationClicked",l);const d=(async t=>{try{const e=await Nt();if(e&&e.status===gt)return;await(async(t,e)=>{await Dt("Outcomes.NotificationClicked",function(t,e){return{appId:t,notificationId:e.notification.notificationId,timestamp:e.timestamp}}(t,e))})(c,t),e&&(e.notificationId=t.notification.notificationId,await Dt("Sessions",e))}catch(e){S.P("Failed to save clicked notification.",e)}})(l),f=await this.ut(),p=ne.At(c,f,l,u),h=await ne.Pt();let b=!1;for(const w of h){const t=w.url;let e="";try{e=new URL(t).origin}catch(y){S.P("Failed to get the HTTP site's actual origin:",y)}let a=null;try{a=new URL(o).origin}catch(y){S.P("Failed parse launchUrl:",y)}if("exact"===i&&t===o||"origin"===i&&e===a){if(w.url===o||"focus"===n&&e===a){ne.rt.V("notification.clicked",l,w);try{w instanceof WindowClient&&await w.focus()}catch(y){S.P("Failed to focus:",w,y)}}else if(w instanceof WindowClient&&w.navigate){try{S.S("Client is standard HTTPS site. Attempting to focus() client."),w instanceof WindowClient&&await w.focus()}catch(y){S.P("Failed to focus:",w,y)}try{r?(S.S(`Redirecting HTTPS site to (${o}).`),await w.navigate(o)):S.S("Not navigating because link is special.")}catch(y){S.P("Failed to navigate:",w,o,y)}}else await ne.Ut(o);b=!0;break}}return r&&!b&&await ne.Ut(o),d&&await d,await p}static async At(t,e,i,n){const a=i.notification;if(!a.notificationId)return void console.error("No notification id, skipping networks calls to report open!");let s;t?s=I(`notifications/${a.notificationId}`,{app_id:t,player_id:e,opened:!0,device_type:n}):console.error("No app Id, skipping OneSignal API call for notification open!"),await ne.ct.click(i,e),s&&await s}static async Ut(t){S.S("Opening notification URL:",t);try{return await self.clients.openWindow(t)}catch(e){return S.I(`Failed to open the URL '${t}':`,e),null}}static dt(t){S.k(`OneSignal Service Worker activated (version ${u})`),t.waitUntil(self.clients.claim())}static async bt(t){S.S(`Called onPushSubscriptionChange(${JSON.stringify(t,null,4)}):`,t);const e=await ne.vt();if(!e)return;const i=await G({appId:e},N);if(!i)return;const n=new Zt(i);let a,s;{let i=(await Ut()).deviceId;if(a=!!i,!a&&t.oldSubscription){i=await async function(t,e,i){return T(t),k("players",{app_id:t,device_type:e,identifier:i,notification_types:-20}).then(t=>t?.result?.id?t.result.id:null).catch(t=>(S.S("Error getting user ID from subscription identifier:",t),null))}(e,w(),t.oldSubscription.endpoint);const n=await Ut();n.deviceId=i,await Wt(n)}a=!!i}const o=t.newSubscription;if(o)s=Yt.H(o);else try{s=await n.ot.it(1)}catch(r){}if(a||s){let t=null;"granted"!==Notification.permission?t=-21:s||(t=-22),await n.ot.J(s,t)}else await Ct("Ids","userId"),await Ct("Ids","registrationId")}static Nt(){return new Promise(t=>{Promise.all([Tt("defaultTitle"),Tt("pageTitle")]).then(([e,i])=>{t(null!==e?e:null!=i?i:"")})})}static _t(t){if(!t||!t.data)return Promise.reject("Missing event.data on push payload!");if(ne.Wt(t.data)){S.S("Received a valid encrypted push payload.");const e=t.data.json();return Promise.resolve([e])}return Promise.reject(`Unexpected push message payload received: ${t.data}`)}static Wt(t){try{const e=t.json();return!!function(t){return"string"==typeof t?.custom?.i}(e)||(S.S("isValidPushPayload: Valid JSON but missing notification UUID:",e),!1)}catch(e){return S.S("isValidPushPayload: Parsing to JSON failed with:",e),!1}}}ne.lt(),self.OneSignalWorker=ne}();
//# sourceMappingURL=OneSignalSDK.sw.js.map
